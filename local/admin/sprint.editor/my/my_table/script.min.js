sprint_editor.registerBlock("my_table",function(c,a,b){b=c.extend({table_caption:"",rows:[[{text:""},{text:""},{text:""}],[{text:""},{text:""},{text:""}],[{text:""},{text:""},{text:""}]]},b);this.getData=function(){return b};this.collectData=function(){b.rows=[];b.table_caption=a.find(".sp-item-text").val();a.find("tr").each(function(){var d=[];c(this).find("td").each(function(){var f={};var e=[];f.text=c(this).text();f.text=c.trim(f.text);if(c(this).hasClass("center")){e.push("center")}else{if(c(this).hasClass("right")){e.push("right")}}if(c(this).hasClass("bold")){e.push("bold")}if(c(this).attr("colspan")){f.colspan=c(this).attr("colspan")}if(c(this).attr("rowspan")){f.rowspan=c(this).attr("rowspan")}if(e.length>0){f.attrs=e}d.push(f)});if(d.length>0){b.rows.push(d)}});return b};this.afterRender=function(){var d=a.find("table");e();a.on("click","td",function(){a.find("td").not(this).removeClass("active");c(this).addClass("active");e()});a.on("click",".sp-add-col",function(h){h.preventDefault();var i=a.find("td.active");if(i.length>0){c('<td contenteditable="true"></td>').insertAfter(i);i.next("td").trigger("click")}e()});a.on("click",".sp-del-col",function(i){i.preventDefault();var j=a.find("td.active");var h=j.parent();if(j.length>0){if(h.find("td").length-1>0){j.next("td").trigger("click");j.remove()}else{h.remove()}}e()});a.on("click",".sp-add-row",function(h){h.preventDefault();f();e()});a.on("click",".sp-del-row",function(h){h.preventDefault();var i=a.find("td.active");if(i.length>0){i.parent().remove()}e()});a.on("click",".sp-sel-row",function(h){h.preventDefault();var i=a.find("td.active");if(i.length>0){i.parent().toggleClass("active")}e()});a.on("click",".sp-add-cs",function(k){k.preventDefault();var l=a.find("td.active");if(l.length>0){var h=l.next("td");if(h.length){var j=h.attr("colspan");j=(j)?parseInt(j,10):1;h.remove();var i=l.attr("colspan");i=(i)?parseInt(i,10):1;l.attr("colspan",i+j)}}e()});a.on("click",".sp-del-cs",function(i){i.preventDefault();var j=a.find("td.active");if(j.length>0){var h=j.attr("colspan");h=(h)?parseInt(h,10):1;if(h-1>1){j.attr("colspan",h-1)}else{j.removeAttr("colspan")}if(h>1){c('<td contenteditable="true"></td>').insertAfter(j)}}e()});a.on("click",".sp-add-rs",function(i){i.preventDefault();var j=a.find("td.active");if(j.length>0){var h=j.attr("rowspan");h=(h)?parseInt(h,10):1;j.attr("rowspan",h+1)}e()});a.on("click",".sp-del-rs",function(i){i.preventDefault();var j=a.find("td.active");if(j.length>0){var h=j.attr("rowspan");h=(h)?parseInt(h,10):1;if(h-1<=1){j.removeAttr("rowspan")}else{j.attr("rowspan",h-1)}}e()});a.on("click",".sp-sel-dn",function(k){var i=a.find("tr.active");if(i.length>0){var j=i.first();var h=i.last();var l=h.next("tr");if(!l.length){l=g(h)}i.insertAfter(l)}});a.on("click",".sp-sel-up",function(k){var i=a.find("tr.active");if(i.length>0){var j=i.first();var h=i.last();var l=j.prev("tr");i.insertBefore(l)}});a.on("click",".sp-toggle-align",function(h){h.preventDefault();var i=a.find("td.active");if(i.length>0){if(i.hasClass("center")){i.removeClass("center");i.addClass("right")}else{if(i.hasClass("right")){i.removeClass("right")}else{i.addClass("center")}}}e()});a.on("click",".sp-toggle-bold",function(h){h.preventDefault();var i=a.find("td.active");if(i.length>0){if(i.hasClass("bold")){i.removeClass("bold")}else{i.addClass("bold")}}e()});function f(){var j=a.find("td.active").parent();if(j.length<=0){j=d.find("tr").last()}var i=0;j.find("td").each(function(){if(c(this).attr("colspan")){i+=+c(this).attr("colspan")}else{i++}});i=(i>0)?i:1;var k="";for(var h=1;h<=i;h++){k+='<td contenteditable="true"></td>'}if(j.length>0){c("<tr>"+k+"</tr>").insertAfter(j)}else{d.append("<tr>"+k+"</tr>")}}function g(j){var i=0;j.find("td").each(function(){if(c(this).attr("colspan")){i+=+c(this).attr("colspan")}else{i++}});i=(i>0)?i:1;var k="";for(var h=1;h<=i;h++){k+='<td contenteditable="true"></td>'}d.append("<tr>"+k+"</tr>");return d.find("tr").last()}function e(){var m=d.find("td.active");a.find(".sp-add-row").show();var j=d.find("tr.active");if(j.length>0){a.find(".sp-sel-up").show();a.find(".sp-sel-dn").show()}else{a.find(".sp-sel-up").hide();a.find(".sp-sel-dn").hide()}if(m.length>0){a.find(".sp-col-buttons").show();a.find(".sp-del-row").show();a.find(".sp-sel-row").show();var k=m.parent();var h=m.next("td");var i=m.attr("rowspan");i=(i)?parseInt(i,10):1;var n=d.find("tr").index(k);var l=d.find("tr").eq(n+i);if(k.find("td").length>1){a.find(".sp-del-col").show()}else{a.find(".sp-del-col").hide()}if(h.length>0){a.find(".sp-add-cs").show()}else{a.find(".sp-add-cs").hide()}if(m.attr("colspan")){a.find(".sp-del-cs").show()}else{a.find(".sp-del-cs").hide()}if(m.attr("rowspan")){a.find(".sp-del-rs").show()}else{a.find(".sp-del-rs").hide()}if(l.length>0){a.find(".sp-add-rs").show()}else{a.find(".sp-add-rs").hide()}}else{a.find(".sp-col-buttons").hide();a.find(".sp-del-row").hide();a.find(".sp-sel-row").hide()}}}});